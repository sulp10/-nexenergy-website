!function(){"use strict";document.body.classList.add("js-loaded"),document.addEventListener("DOMContentLoaded",function(){function e(e,t){"function"==typeof gtag&&gtag("event",e,t)}(function(){const e=document.querySelector(".menu-toggle");if(document.querySelector(".header"),!e)return;const t=document.createElement("div");t.className="mobile-menu",t.innerHTML='\n      <button class="mobile-menu-close" aria-label="Chiudi menu">&times;</button>\n      <nav>\n        <a href="#problema">Il Problema</a>\n        <a href="#soluzione">La Soluzione</a>\n        <a href="#metodo">Il Metodo</a>\n        <a href="/blog/">Blog</a>\n        <a href="#contatti" class="btn btn-primary">Richiedi Demo</a>\n      </nav>\n    ',document.body.appendChild(t);const n=t.querySelector(".mobile-menu-close");function o(){t.classList.remove("active"),document.body.style.overflow=""}e.addEventListener("click",function(e){e.stopPropagation(),t.classList.contains("active")?o():(t.classList.add("active"),document.body.style.overflow="hidden")}),n.addEventListener("click",o),t.querySelectorAll("a").forEach(function(e){e.addEventListener("click",o)}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("active")&&o()})})(),document.querySelectorAll('a[href^="#"]').forEach(function(e){e.addEventListener("click",function(e){const t=this.getAttribute("href");if("#"===t)return;const n=document.querySelector(t);if(!n)return;e.preventDefault();const o=document.querySelector(".header").offsetHeight,r=n.getBoundingClientRect().top+window.pageYOffset-o;window.scrollTo({top:r,behavior:"smooth"})})}),function(){const e=document.querySelectorAll(".benefit-card, .phase, .problema-content > *, .contact-form, .metodo-quote, .feature-card, .reveal-on-scroll"),t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("is-visible"),e.target.classList.add("active"),t.unobserve(e.target))})},{root:null,threshold:.1,rootMargin:"0px 0px -20px 0px"});e.forEach(e=>{e.classList.add("reveal-on-scroll"),t.observe(e)})}(),function(){const t=document.getElementById("contact-form");if(!t)return;const n=document.querySelector(".form-success");function o(e){const t=e.closest(".form-group");let n=!0;return e.value.trim()||(n=!1),"email"===e.type&&e.value&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value)||(n=!1)),!n&&t&&(t.classList.add("has-error"),e.classList.add("error")),n}t.addEventListener("submit",function(r){r.preventDefault(),t.querySelectorAll(".form-group").forEach(function(e){e.classList.remove("has-error")}),t.querySelectorAll("input, select").forEach(function(e){e.classList.remove("error")});let s=!0;t.querySelectorAll("[required]").forEach(function(e){o(e)||(s=!1)}),s&&(e("form_submit_demo",{event_category:"lead_generation",event_label:"contact_form"}),async function(e){const t=new FormData(e),o=Object.fromEntries(t.entries()),r=new URLSearchParams(window.location.search);["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(function(e){r.has(e)&&(o[e]=r.get(e))});const s=e.querySelector('button[type="submit"]'),c=s.textContent;s.disabled=!0,s.textContent="Invio in corso...";try{const t=["/api/contact/submit","/.netlify/functions/contact-submit"];let r;for(const e of t)try{if(r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),404!==r.status)break}catch(e){}if(!r||!r.ok)throw new Error("Errore invio");e.style.display="none",n&&(n.hidden=!1)}catch(e){alert("Si Ã¨ verificato un errore. Riprova o contattaci direttamente via email."),s.disabled=!1,s.textContent=c}}(t))}),t.querySelectorAll("[required]").forEach(function(e){e.addEventListener("blur",function(){o(this)}),e.addEventListener("input",function(){const e=this.closest(".form-group");e&&e.classList.remove("has-error"),this.classList.remove("error")})})}(),function(){const t=document.querySelectorAll("section[id]"),n=new IntersectionObserver(function(t){t.forEach(function(t){t.isIntersecting&&e("section_view",{event_category:"engagement",event_label:t.target.id})})},{root:null,rootMargin:"-50% 0px",threshold:0});t.forEach(function(e){n.observe(e)})}(),document.querySelectorAll("[data-track]").forEach(function(t){t.addEventListener("click",function(){e(this.getAttribute("data-track"),{event_category:"engagement",event_label:this.textContent.trim()})})}),function(){const e=document.getElementById("calc-rooms"),t=document.getElementById("calc-occupancy"),n=document.getElementById("calc-energy-cost"),o=document.getElementById("energy-minus"),r=document.getElementById("energy-plus"),s=document.getElementById("energy-display-val"),c=document.getElementById("roi-rooms-val"),i=document.getElementById("roi-occupancy-val"),a=document.getElementById("roi-savings-year"),l=document.getElementById("roi-months-standard"),d=document.getElementById("roi-months-incentivized"),u=document.getElementById("roi-investment-total"),m=document.getElementById("roi-investment-discounted");function f(){const o=parseInt(e.value),r=parseInt(t.value),f=parseFloat(n.value);c.textContent=o,i.textContent=r+"%",s&&(s.textContent=f.toFixed(2));const v=25*o*(r/100*365)*.42*f,h=150*o+3e4+5e3,y=.2*h,g=h/v*12,p=y/v*12,E=new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR",maximumFractionDigits:0});a.textContent=E.format(v),u.textContent=E.format(h),m.textContent=E.format(y),l.textContent=Math.max(1,Math.round(g))+" Mesi";const b=Math.max(.1,p);d.textContent=b<1?"< 1 Mese!":Math.round(b)+" Mesi"}e&&t&&n&&(o&&r&&(o.addEventListener("click",()=>{let e=parseFloat(n.value);e>.05&&(n.value=(e-.05).toFixed(2),f())}),r.addEventListener("click",()=>{let e=parseFloat(n.value);e<1&&(n.value=(e+.05).toFixed(2),f())})),e.addEventListener("input",f),t.addEventListener("input",f),f(),window.updateRoi=f)}(),function(){const t=document.getElementById("newsletter-popup"),n=document.getElementById("newsletter-form");if(!t||!n)return;const o="nexenergy_newsletter_shown";if(sessionStorage.getItem(o))return;const r=t.querySelectorAll("[data-close-popup]"),s=document.getElementById("newsletter-email"),c=document.getElementById("newsletter-name"),i=document.getElementById("newsletter-gdpr"),a=t.querySelector(".newsletter-submit"),l=t.querySelector(".newsletter-submit-text"),d=t.querySelector(".newsletter-submit-loading"),u=t.querySelector(".newsletter-success"),m=t.querySelector(".newsletter-error-state"),f=t.querySelector(".newsletter-retry");let v=setTimeout(h,3e4);function h(){t.hidden=!1,sessionStorage.setItem(o,"true"),document.body.style.overflow="hidden",e("newsletter_popup_view",{event_category:"newsletter",event_label:"popup_shown"})}function y(){t.hidden=!0,document.body.style.overflow=""}window.matchMedia("(hover: hover)").matches&&document.addEventListener("mouseout",function e(n){n.clientY<=0&&0==!t.hasAttribute("hidden")&&(clearTimeout(v),h(),document.removeEventListener("mouseout",e))}),r.forEach(function(e){e.addEventListener("click",y)}),document.addEventListener("keydown",function(e){"Escape"!==e.key||t.hidden||y()}),s.addEventListener("input",function(){this.closest(".newsletter-form-group").classList.remove("has-error"),this.classList.remove("error")}),i.addEventListener("change",function(){this.closest(".newsletter-form-group").classList.remove("has-error")}),n.addEventListener("submit",async function(t){if(t.preventDefault(),function(){let e=!0;const t=s.closest(".newsletter-form-group");s.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.value)?(t.classList.remove("has-error"),s.classList.remove("error")):(t.classList.add("has-error"),s.classList.add("error"),e=!1);const n=i.closest(".newsletter-form-group");return i.checked?n.classList.remove("has-error"):(n.classList.add("has-error"),e=!1),e}()){a.disabled=!0,l.hidden=!0,d.hidden=!1;try{const t=await async function(e){const t=["/api/newsletter/subscribe","/.netlify/functions/newsletter-subscribe"],n=JSON.stringify({email:e.email,fields:{name:e.name||""}});for(const e of t)try{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:n});if(404!==t.status)return await t.json()}catch(e){}return function(e){const t=JSON.parse(localStorage.getItem("nexenergy_newsletter_signups")||"[]");t.push({email:e.email,name:e.name,timestamp:(new Date).toISOString()}),localStorage.setItem("nexenergy_newsletter_signups",JSON.stringify(t))}(e),{success:!0,message:"Stored locally (demo mode)"}}({email:s.value.trim(),name:c.value.trim()||void 0});if(!t.success)throw new Error(t.message||"Subscription failed");n.hidden=!0,u.hidden=!1,e("newsletter_signup",{event_category:"newsletter",event_label:"subscription_success"}),setTimeout(y,3e3)}catch(t){n.hidden=!0,m.hidden=!1,e("newsletter_error",{event_category:"newsletter",event_label:t.message})}finally{a.disabled=!1,l.hidden=!1,d.hidden=!0}}}),f&&f.addEventListener("click",function(){m.hidden=!0,n.hidden=!1})}(),function(){const e=document.querySelectorAll(".btn");e.forEach(e=>e.classList.add("btn-magnetic")),e.forEach(e=>{e.addEventListener("mousemove",function(t){const n=e.getBoundingClientRect(),o=t.clientX-n.left-n.width/2,r=t.clientY-n.top-n.height/2;e.style.transform=`translate(${o/5}px, ${r/5}px) scale(1.05)`}),e.addEventListener("mouseleave",function(){e.style.transform="translate(0, 0) scale(1)"})})}()})}();